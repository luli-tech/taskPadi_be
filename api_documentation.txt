# Task Manager API Documentation

## Base URL
All endpoints are prefixed with `/api` unless otherwise specified.

## Authentication
All protected endpoints require a Bearer token in the Authorization header:
```
Authorization: Bearer <your_jwt_token>
```

---

## Authentication Endpoints (Base: /api/auth)

### POST /api/auth/register
Creates a new regular user account (creates users with `is_admin: false` by default).

**Request Body (JSON):**
```json
{
  "username": "string (required, min: 3, max: 255 characters)",
  "email": "string (required, valid email format)",
  "password": "string (required, min: 6 characters)"
}
```

**Fields:**
- `username` (string, required): Username for the account (3-255 characters)
- `email` (string, required): Valid email address
- `password` (string, required): Password (minimum 6 characters)

**Response:** `201 Created`
```json
{
  "access_token": "string",
  "refresh_token": "string",
  "user": {
    "id": "uuid",
    "username": "string",
    "email": "string",
    "role": "user",
    "is_admin": false,
    "avatar_url": "string | null",
    "bio": "string | null",
    "theme": "string",
    "is_active": true,
    "notification_enabled": true,
    "created_at": "datetime"
  }
}
```

**Error Responses:**
- `400 Bad Request`: Validation error (e.g., invalid email format, password too short)
- `409 Conflict`: User already exists (duplicate email or username)
- `500 Internal Server Error`: Server error

---

### POST /api/auth/login
Authenticates user with email and password. **Note: Login is email-only. Username login is not supported.**

**Request Body (JSON):**
```json
{
  "email": "string (required, valid email format)",
  "password": "string (required, min: 6 characters)"
}
```

**Fields:**
- `email` (string, required): User email address (must be valid email format)
- `password` (string, required): User password (minimum 6 characters)

**Response:** `200 OK`
```json
{
  "access_token": "string",
  "refresh_token": "string",
  "user": {
    "id": "uuid",
    "username": "string",
    "email": "string",
    "role": "string",
    "is_admin": boolean,
    "avatar_url": "string | null",
    "bio": "string | null",
    "theme": "string",
    "is_active": boolean,
    "notification_enabled": boolean,
    "created_at": "datetime"
  }
}
```

**Error Responses:**
- `400 Bad Request`: Validation error (invalid email format, password too short)
- `401 Unauthorized`: Authentication failed with specific error message:
  - `"No account found with this email address"` - Email doesn't exist in the system
  - `"Incorrect password"` - Email exists but password is wrong
  - `"This account was created with Google. Please use Google login"` - Account was created via OAuth and has no password
- `500 Internal Server Error`: Server error

---

### POST /api/auth/refresh
Issues a new access token and refresh token using a valid refresh token.

**Request Body (JSON):**
```json
{
  "refresh_token": "string (required)"
}
```

**Fields:**
- `refresh_token` (string, required): Valid refresh token from previous login/register

**Response:** `200 OK`
```json
{
  "access_token": "string",
  "refresh_token": "string"
}
```

**Error Responses:**
- `400 Bad Request`: Validation error
- `401 Unauthorized`: Invalid or expired refresh token
- `500 Internal Server Error`: Server error

---

### POST /api/auth/logout
Revokes the refresh token and logs out the user.

**Request Body (JSON):**
```json
{
  "refresh_token": "string (required)"
}
```

**Fields:**
- `refresh_token` (string, required): Refresh token to revoke

**Response:** `200 OK` (empty body)

**Error Responses:**
- `400 Bad Request`: Invalid input
- `401 Unauthorized`: Invalid token
- `500 Internal Server Error`: Server error

---

### GET /api/auth/google
Initiates Google OAuth2 login flow. Redirects to Google OAuth consent page.

**Path Parameters:** None

**Query Parameters:** None

**Response:** `302 Found` (Redirect to Google OAuth)

**Note:** Public endpoint, no authentication required

---

### GET /api/auth/google/callback
Handles the callback from Google OAuth2 after user authorization.

**Path Parameters:** None

**Query Parameters:**
- `code` (string, required): Authorization code from Google
- `state` (string, optional): CSRF token (ignored but accepted)

**Response:** `200 OK`
```json
{
  "access_token": "string",
  "refresh_token": "string",
  "user": {
    "id": "uuid",
    "username": "string",
    "email": "string",
    "role": "string",
    "is_admin": boolean,
    "avatar_url": "string | null",
    ...
  }
}
```

**Error Responses:**
- `500 Internal Server Error`: OAuth failed (invalid code, network error, etc.)

**Note:** Public endpoint, no authentication required

---

## User Profile Endpoints (Base: /api/users)
**All endpoints require authentication.**

### GET /api/users
Lists all available users (for finding users to chat with). Excludes the current user and inactive users.

**Path Parameters:** None

**Query Parameters:**
- `page` (integer, optional): Page number (default: 1, minimum: 1)
- `limit` (integer, optional): Items per page (default: 20, maximum: 100)
- `search` (string, optional): Search by username or email (case-insensitive partial match)

**Response:** `200 OK`
```json
{
  "data": [
    {
      "id": "uuid",
      "username": "string",
      "email": "string",
      "avatar_url": "string | null",
      "bio": "string | null",
      "theme": "string",
      "role": "string",
      "is_admin": boolean,
      "is_active": true,
      "notification_enabled": boolean,
      "created_at": "datetime"
    }
  ],
  "total": integer,
  "page": integer,
  "limit": integer,
  "total_pages": integer
}
```

**Note:** 
- Only returns active users (`is_active = true`)
- Excludes the authenticated user
- Results are sorted alphabetically by username
- Useful for finding users to start new conversations with

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token

---

### GET /api/users/me
Returns the currently authenticated user's profile.

**Path Parameters:** None

**Query Parameters:** None

**Headers:**
- `Authorization: Bearer <token>` (required)

**Response:** `200 OK`
```json
{
  "id": "uuid",
  "username": "string",
  "email": "string",
  "role": "string",
  "is_admin": boolean,
  "avatar_url": "string | null",
  "bio": "string | null",
  "theme": "string",
  "is_active": boolean,
  "notification_enabled": boolean,
  "created_at": "datetime"
}
```

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token

---

### PUT /api/users/me
Updates the current user's profile information.

**Path Parameters:** None

**Query Parameters:** None

**Request Body (JSON):**
```json
{
  "username": "string (optional, min: 3, max: 50 characters)",
  "bio": "string (optional)",
  "theme": "string (optional, min: 1, max: 50 characters)",
  "avatar_url": "string (optional)"
}
```

**Fields:**
- `username` (string, optional): New username (3-50 characters)
- `bio` (string, optional): User biography
- `theme` (string, optional): UI theme preference (1-50 characters)
- `avatar_url` (string, optional): Profile picture URL

**Response:** `200 OK`
```json
{
  "id": "uuid",
  "username": "string",
  "email": "string",
  ...
}
```

**Error Responses:**
- `400 Bad Request`: Validation error (e.g., username too short)
- `401 Unauthorized`: Missing or invalid authentication token

---

### GET /api/users/me/stats
Returns task statistics for the current user.

**Path Parameters:** None

**Query Parameters:** None

**Response:** `200 OK`
```json
{
  "total_tasks": integer,
  "pending_tasks": integer,
  "in_progress_tasks": integer,
  "completed_tasks": integer,
  "archived_tasks": integer,
  "completion_rate": float (0.0-1.0),
  "low_priority_tasks": integer,
  "medium_priority_tasks": integer,
  "high_priority_tasks": integer,
  "urgent_priority_tasks": integer
}
```

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token

---

## Task Management Endpoints (Base: /api/tasks)
**All endpoints require authentication.**

### GET /api/tasks
Retrieves a paginated list of tasks (including tasks shared with the user).

**Path Parameters:** None

**Query Parameters:**
- `status` (string, optional): Filter by single status
  - Values: `pending`, `in_progress`, `completed`, `cancelled`
- `statuses[]` (array of strings, optional): Filter by multiple statuses
  - Example: `?statuses[]=pending&statuses[]=in_progress`
- `priority` (string, optional): Filter by single priority
  - Values: `low`, `medium`, `high`, `urgent`
- `priorities[]` (array of strings, optional): Filter by multiple priorities
  - Example: `?priorities[]=high&priorities[]=urgent`
- `search` (string, optional): Search in title and description (case-insensitive)
- `created_from` (datetime, optional): Filter tasks created after this date (ISO 8601 format)
- `created_to` (datetime, optional): Filter tasks created before this date (ISO 8601 format)
- `due_from` (datetime, optional): Filter tasks due after this date (ISO 8601 format)
- `due_to` (datetime, optional): Filter tasks due before this date (ISO 8601 format)
- `sort_by` (string, optional): Sort field
  - Values: `created_at`, `due_date`, `priority`, `status`, `title`
  - Default: `created_at`
- `sort_order` (string, optional): Sort direction
  - Values: `asc`, `desc`
  - Default: `desc`
- `page` (integer, optional): Page number (default: 1, minimum: 1)
- `limit` (integer, optional): Items per page (default: 20, maximum: 100)

**Response:** `200 OK`
```json
{
  "data": [
    {
      "id": "uuid",
      "user_id": "uuid",
      "title": "string",
      "description": "string | null",
      "status": "string",
      "priority": "string",
      "due_date": "datetime | null",
      "reminder_time": "datetime | null",
      "notified": boolean,
      "created_at": "datetime",
      "updated_at": "datetime"
    }
  ],
  "total": integer,
  "page": integer,
  "limit": integer,
  "total_pages": integer
}
```

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token

---

### POST /api/tasks
Creates a new task.

**Path Parameters:** None

**Query Parameters:** None

**Request Body (JSON):**
```json
{
  "title": "string (required, min: 1, max: 500 characters)",
  "description": "string (optional)",
  "priority": "string (optional)",
  "due_date": "datetime (optional, ISO 8601 format)",
  "reminder_time": "datetime (optional, ISO 8601 format)"
}
```

**Fields:**
- `title` (string, required): Task title (1-500 characters)
- `description` (string, optional): Task description
- `priority` (string, optional): Priority level
  - Values: `low`, `medium`, `high`, `urgent`
  - Default: `medium`
- `due_date` (datetime, optional): Due date for the task (ISO 8601 format)
- `reminder_time` (datetime, optional): Reminder notification time (ISO 8601 format)

**Response:** `201 Created`
```json
{
  "id": "uuid",
  "user_id": "uuid",
  "title": "string",
  "description": "string | null",
  "status": "pending",
  "priority": "string",
  "due_date": "datetime | null",
  "reminder_time": "datetime | null",
  "notified": false,
  "created_at": "datetime",
  "updated_at": "datetime"
}
```

**Error Responses:**
- `400 Bad Request`: Validation error (e.g., title too long, invalid priority)
- `401 Unauthorized`: Missing or invalid authentication token

---

### GET /api/tasks/:id
Retrieves detailed information about a specific task.

**Path Parameters:**
- `id` (uuid, required): Task ID

**Query Parameters:** None

**Response:** `200 OK`
```json
{
  "id": "uuid",
  "user_id": "uuid",
  "title": "string",
  "description": "string | null",
  "status": "string",
  "priority": "string",
  "due_date": "datetime | null",
  "reminder_time": "datetime | null",
  "notified": boolean,
  "created_at": "datetime",
  "updated_at": "datetime"
}
```

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token
- `403 Forbidden`: User doesn't have access to this task (not owner or member)
- `404 Not Found`: Task not found

---

### PUT /api/tasks/:id
Updates an existing task.

**Path Parameters:**
- `id` (uuid, required): Task ID

**Query Parameters:** None

**Request Body (JSON):**
```json
{
  "title": "string (optional, min: 1, max: 500 characters)",
  "description": "string (optional)",
  "status": "string (optional)",
  "priority": "string (optional)",
  "due_date": "datetime (optional, ISO 8601 format)",
  "reminder_time": "datetime (optional, ISO 8601 format)"
}
```

**Fields:**
- `title` (string, optional): Task title (1-500 characters)
- `description` (string, optional): Task description
- `status` (string, optional): Task status
  - Values: `pending`, `in_progress`, `completed`, `cancelled`
- `priority` (string, optional): Priority level
  - Values: `low`, `medium`, `high`, `urgent`
- `due_date` (datetime, optional): Due date (ISO 8601 format)
- `reminder_time` (datetime, optional): Reminder time (ISO 8601 format)

**Response:** `200 OK`
```json
{
  "id": "uuid",
  "user_id": "uuid",
  "title": "string",
  ...
}
```

**Error Responses:**
- `400 Bad Request`: Validation error
- `401 Unauthorized`: Missing or invalid authentication token
- `403 Forbidden`: Not task owner (only owner can update)
- `404 Not Found`: Task not found

---

### DELETE /api/tasks/:id
Deletes a task (only allowed for task owner).

**Path Parameters:**
- `id` (uuid, required): Task ID

**Query Parameters:** None

**Request Body:** None

**Response:** `204 No Content` (empty body)

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token
- `403 Forbidden`: Not task owner (only owner can delete)
- `404 Not Found`: Task not found

---

### PATCH /api/tasks/:id/status
Quickly updates only the status of a task.

**Path Parameters:**
- `id` (uuid, required): Task ID

**Query Parameters:** None

**Request Body (JSON):**
```json
{
  "status": "string (required)"
}
```

**Fields:**
- `status` (string, required): New status
  - Values: `pending`, `in_progress`, `completed`, `cancelled`

**Response:** `200 OK`
```json
{
  "id": "uuid",
  "status": "string",
  ...
}
```

**Error Responses:**
- `400 Bad Request`: Invalid status value
- `401 Unauthorized`: Missing or invalid authentication token
- `404 Not Found`: Task not found

---

### POST /api/tasks/:id/share
Shares a task with other users (Collaboration feature).

**Path Parameters:**
- `id` (uuid, required): Task ID

**Query Parameters:** None

**Request Body (JSON):**
```json
{
  "user_ids": ["uuid", "uuid", ...] (required, array of UUIDs, min: 1 user)
}
```

**Fields:**
- `user_ids` (array of uuid, required): List of user IDs to share the task with (minimum 1 user)

**Response:** `200 OK`
```json
{
  "id": "uuid",
  "title": "string",
  ...
}
```

**Error Responses:**
- `400 Bad Request`: Validation error (empty array, invalid UUID)
- `401 Unauthorized`: Missing or invalid authentication token
- `404 Not Found`: Task not found or user(s) not found

---

### GET /api/tasks/:id/members
Lists all members/collaborators of a task.

**Path Parameters:**
- `id` (uuid, required): Task ID

**Query Parameters:** None

**Response:** `200 OK`
```json
[
  {
    "user_id": "uuid",
    "username": "string",
    "avatar_url": "string | null",
    "role": "string",
    "added_at": "datetime",
    "added_by": "uuid | null"
  }
]
```

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token
- `404 Not Found`: Task not found

---

### DELETE /api/tasks/:id/members/:user_id
Removes a collaborator from a task.

**Path Parameters:**
- `id` (uuid, required): Task ID
- `user_id` (uuid, required): User ID to remove from task

**Query Parameters:** None

**Request Body:** None

**Response:** `204 No Content` (empty body)

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token
- `403 Forbidden`: Not task owner (only owner can remove members)
- `404 Not Found`: Task not found or user not a member

---

### GET /api/tasks/:id/activity
Returns the activity logs (history) for a specific task.

**Path Parameters:**
- `id` (uuid, required): Task ID

**Query Parameters:** None

**Response:** `200 OK`
```json
[
  {
    "id": "uuid",
    "user_id": "uuid | null",
    "username": "string | null",
    "action": "string",
    "details": "object | null",
    "created_at": "datetime"
  }
]
```

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token
- `404 Not Found`: Task not found

---

### GET /api/tasks/stream
Server-Sent Events (SSE) stream for real-time task updates.

**Path Parameters:** None

**Query Parameters:** None

**Headers:**
- `Accept: text/event-stream` (recommended)

**Response:** `200 OK` (SSE stream)
- Content-Type: `text/event-stream`
- Streams task update events as they occur (create, update, delete, status changes)

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token

**Note:** Connection remains open until client disconnects. Server sends periodic keep-alive pings.

---

## Messaging Endpoints (Base: /api/messages)
**All endpoints require authentication.**

### GET /api/messages/conversations
Retrieves a list of all active conversations for the authenticated user.

**Path Parameters:** None

**Query Parameters:** None

**Response:** `200 OK`
```json
[
  {
    "user_id": "uuid",
    "username": "string",
    "avatar_url": "string | null",
    "last_message": "string",
    "last_message_time": "datetime",
    "unread_count": integer
  }
]
```

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token

---

### POST /api/messages
Sends a message to another user (1-on-1) or to a group. Either `receiver_id` (for 1-on-1) or `group_id` (for group message) must be provided, but not both.

**Path Parameters:** None

**Query Parameters:** None

**Request Body (JSON):**
```json
{
  "receiver_id": "uuid (optional, for 1-on-1 messages)",
  "group_id": "uuid (optional, for group messages)",
  "content": "string (required, min: 1 character)",
  "image_url": "string (optional)"
}
```

**Fields:**
- `receiver_id` (uuid, optional): ID of the user to send a 1-on-1 message to. Required if `group_id` is not provided.
- `group_id` (uuid, optional): ID of the group to send a group message to. Required if `receiver_id` is not provided.
- `content` (string, required): Message content (minimum 1 character)
- `image_url` (string, optional): URL of attached image

**Note:** 
- For 1-on-1 messages: Provide `receiver_id` and leave `group_id` as `null`
- For group messages: Provide `group_id` and leave `receiver_id` as `null`
- You must be a member of the group to send messages to it

**Response:** `201 Created`
```json
{
  "id": "uuid",
  "sender_id": "uuid",
  "receiver_id": "uuid | null",
  "group_id": "uuid | null",
  "content": "string",
  "image_url": "string | null",
  "is_read": false,
  "created_at": "datetime"
}
```

**Error Responses:**
- `400 Bad Request`: 
  - Validation error (e.g., empty content)
  - Both `receiver_id` and `group_id` provided
  - Neither `receiver_id` nor `group_id` provided
- `401 Unauthorized`: Missing or invalid authentication token
- `403 Forbidden`: Not a member of the group
- `404 Not Found`: Receiver or group not found

---

### GET /api/messages/conversation/:user_id
Retrieves paginated message history with a specific user (1-on-1 conversation only).

**Path Parameters:**
- `user_id` (uuid, required): Other user's ID to get conversation with

**Query Parameters:**
- `page` (integer, optional): Page number (default: 1, minimum: 1)
- `limit` (integer, optional): Items per page (default: 50, maximum: 100)

**Response:** `200 OK`
```json
{
  "data": [
    {
      "id": "uuid",
      "sender_id": "uuid",
      "receiver_id": "uuid",
      "group_id": null,
      "content": "string",
      "image_url": "string | null",
      "is_read": boolean,
      "created_at": "datetime"
    }
  ],
  "total": integer,
  "page": integer,
  "limit": integer,
  "total_pages": integer
}
```

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token
- `404 Not Found`: User not found

---

### GET /api/messages/groups/:group_id
Retrieves paginated message history for a specific group. Only group members can access group messages.

**Path Parameters:**
- `group_id` (uuid, required): Group ID to get messages from

**Query Parameters:**
- `page` (integer, optional): Page number (default: 1, minimum: 1)
- `limit` (integer, optional): Items per page (default: 50, maximum: 100)

**Response:** `200 OK`
```json
{
  "data": [
    {
      "id": "uuid",
      "sender_id": "uuid",
      "receiver_id": null,
      "group_id": "uuid",
      "content": "string",
      "image_url": "string | null",
      "is_read": boolean,
      "created_at": "datetime"
    }
  ],
  "total": integer,
  "page": integer,
  "limit": integer,
  "total_pages": integer
}
```

**Note:** Messages are automatically marked as read when retrieved.

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token
- `403 Forbidden`: Not a member of the group
- `404 Not Found`: Group not found

---

### GET /api/messages/conversation/:user_id
Retrieves paginated message history with a specific user (1-on-1 conversation only).

**Path Parameters:**
- `user_id` (uuid, required): Other user's ID to get conversation with

**Query Parameters:**
- `page` (integer, optional): Page number (default: 1)
- `limit` (integer, optional): Items per page (default: 50)

**Response:** `200 OK`
```json
{
  "data": [
    {
      "id": "uuid",
      "sender_id": "uuid",
      "receiver_id": "uuid",
      "content": "string",
      "image_url": "string | null",
      "is_read": boolean,
      "created_at": "datetime"
    }
  ],
  "total": integer,
  "page": integer,
  "limit": integer,
  "total_pages": integer
}
```

**Note:** Automatically marks messages from the other user as read.

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token
- `404 Not Found`: User not found

---

### PUT /api/messages/:id
Updates a message. Only the sender can update their own messages.

**Path Parameters:**
- `id` (uuid, required): Message ID to update

**Query Parameters:** None

**Request Body (JSON):**
```json
{
  "content": "string (required, min: 1 character)",
  "image_url": "string (optional)"
}
```

**Fields:**
- `content` (string, required): Updated message content (minimum 1 character)
- `image_url` (string, optional): Updated image URL

**Response:** `200 OK`
```json
{
  "id": "uuid",
  "sender_id": "uuid",
  "receiver_id": "uuid | null",
  "group_id": "uuid | null",
  "content": "string",
  "image_url": "string | null",
  "is_read": false,
  "created_at": "datetime",
  "updated_at": "datetime"
}
```

**Error Responses:**
- `400 Bad Request`: Validation error (e.g., empty content)
- `401 Unauthorized`: Missing or invalid authentication token
- `403 Forbidden`: Not the message sender
- `404 Not Found`: Message not found

---

### DELETE /api/messages/:id
Deletes a message. Only the sender can delete their own messages.

**Path Parameters:**
- `id` (uuid, required): Message ID to delete

**Query Parameters:** None

**Request Body:** None

**Response:** `204 No Content` (empty body)

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token
- `403 Forbidden`: Not the message sender
- `404 Not Found`: Message not found

---

### PATCH /api/messages/:id/read
Marks a specific message as read.

**Path Parameters:**
- `id` (uuid, required): Message ID to mark as read

**Query Parameters:** None

**Request Body:** None

**Response:** `200 OK` (empty body)

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token
- `404 Not Found`: Message not found

---

## Group Chat Endpoints (Base: /api/groups)
**All endpoints require authentication.**
Groups are private - only members can access them. Only the group creator can manage members and update/delete the group.

### POST /api/groups
Creates a new group. The authenticated user automatically becomes the group creator and first member.

**Path Parameters:** None

**Query Parameters:** None

**Request Body (JSON):**
```json
{
  "name": "string (required, min: 1, max: 255 characters)",
  "description": "string (optional, max: 1000 characters)",
  "avatar_url": "string (optional)"
}
```

**Fields:**
- `name` (string, required): Group name (1-255 characters)
- `description` (string, optional): Group description (maximum 1000 characters)
- `avatar_url` (string, optional): URL of the group avatar image

**Response:** `201 Created`
```json
{
  "id": "uuid",
  "name": "string",
  "description": "string | null",
  "creator_id": "uuid",
  "avatar_url": "string | null",
  "member_count": integer,
  "created_at": "datetime",
  "updated_at": "datetime"
}
```

**Error Responses:**
- `400 Bad Request`: Validation error (e.g., name too long)
- `401 Unauthorized`: Missing or invalid authentication token

---

### GET /api/groups
Retrieves a list of all groups the authenticated user is a member of.

**Path Parameters:** None

**Query Parameters:** None

**Response:** `200 OK`
```json
[
  {
    "id": "uuid",
    "name": "string",
    "description": "string | null",
    "creator_id": "uuid",
    "avatar_url": "string | null",
    "member_count": integer,
    "created_at": "datetime",
    "updated_at": "datetime"
  }
]
```

**Note:** 
- Only returns groups where the authenticated user is a member
- Results are sorted by `updated_at` in descending order (most recently active first)

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token

---

### GET /api/groups/:group_id
Retrieves detailed information about a specific group. Only group members can access.

**Path Parameters:**
- `group_id` (uuid, required): Group ID

**Query Parameters:** None

**Response:** `200 OK`
```json
{
  "id": "uuid",
  "name": "string",
  "description": "string | null",
  "creator_id": "uuid",
  "avatar_url": "string | null",
  "member_count": integer,
  "created_at": "datetime",
  "updated_at": "datetime"
}
```

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token
- `403 Forbidden`: Not a member of the group
- `404 Not Found`: Group not found

---

### PUT /api/groups/:group_id
Updates group information (name, description, avatar). Only the group creator can update the group.

**Path Parameters:**
- `group_id` (uuid, required): Group ID

**Query Parameters:** None

**Request Body (JSON):**
```json
{
  "name": "string (optional, min: 1, max: 255 characters)",
  "description": "string (optional, max: 1000 characters)",
  "avatar_url": "string (optional)"
}
```

**Fields:**
- `name` (string, optional): New group name (1-255 characters)
- `description` (string, optional): New group description (maximum 1000 characters)
- `avatar_url` (string, optional): New group avatar URL

**Response:** `200 OK`
```json
{
  "id": "uuid",
  "name": "string",
  "description": "string | null",
  "creator_id": "uuid",
  "avatar_url": "string | null",
  "member_count": integer,
  "created_at": "datetime",
  "updated_at": "datetime"
}
```

**Error Responses:**
- `400 Bad Request`: Validation error
- `401 Unauthorized`: Missing or invalid authentication token
- `403 Forbidden`: Only the group creator can update the group
- `404 Not Found`: Group not found

---

### DELETE /api/groups/:group_id
Deletes a group and all associated messages. Only the group creator can delete the group.

**Path Parameters:**
- `group_id` (uuid, required): Group ID

**Query Parameters:** None

**Request Body:** None

**Response:** `204 No Content` (empty body)

**Warning:** This action is irreversible. All group messages will be permanently deleted.

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token
- `403 Forbidden`: Only the group creator can delete the group
- `404 Not Found`: Group not found

---

### GET /api/groups/:group_id/members
Retrieves a list of all members in a group. Only group members can view the member list.

**Path Parameters:**
- `group_id` (uuid, required): Group ID

**Query Parameters:** None

**Response:** `200 OK`
```json
[
  {
    "id": "uuid",
    "group_id": "uuid",
    "user_id": "uuid",
    "username": "string",
    "avatar_url": "string | null",
    "role": "creator | member",
    "joined_at": "datetime"
  }
]
```

**Fields:**
- `role`: Either `"creator"` (group creator) or `"member"` (regular member)
- Results are sorted by `joined_at` in ascending order (earliest members first)

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token
- `403 Forbidden`: Not a member of the group
- `404 Not Found`: Group not found

---

### POST /api/groups/:group_id/members
Adds a user to the group. Only the group creator can add members.

**Path Parameters:**
- `group_id` (uuid, required): Group ID

**Query Parameters:** None

**Request Body (JSON):**
```json
{
  "user_id": "uuid (required)"
}
```

**Fields:**
- `user_id` (uuid, required): ID of the user to add to the group

**Response:** `201 Created`
```json
{
  "id": "uuid",
  "group_id": "uuid",
  "user_id": "uuid",
  "username": "string",
  "avatar_url": "string | null",
  "role": "member",
  "joined_at": "datetime"
}
```

**Error Responses:**
- `400 Bad Request`: 
  - User is already a member of the group
  - Validation error (invalid user_id)
- `401 Unauthorized`: Missing or invalid authentication token
- `403 Forbidden`: Only the group creator can add members
- `404 Not Found`: Group or user not found

---

### DELETE /api/groups/:group_id/members/:user_id
Removes a user from the group. Only the group creator can remove members. The creator cannot be removed.

**Path Parameters:**
- `group_id` (uuid, required): Group ID
- `user_id` (uuid, required): ID of the user to remove from the group

**Query Parameters:** None

**Request Body:** None

**Response:** `204 No Content` (empty body)

**Error Responses:**
- `400 Bad Request`: Cannot remove the group creator
- `401 Unauthorized`: Missing or invalid authentication token
- `403 Forbidden`: Only the group creator can remove members
- `404 Not Found`: Group or member not found

---

## Video Call Endpoints (Base: /api/video-calls)

The video call system allows users to initiate, accept, reject, and end video calls with other users. WebRTC signaling (SDP offers, answers, and ICE candidates) is handled through WebSocket connections for real-time communication.

### POST /api/video-calls
Initiates a new video call with another user.

**Path Parameters:** None

**Query Parameters:** None

**Request Body (JSON):**
```json
{
  "receiver_id": "uuid (required)"
}
```

**Fields:**
- `receiver_id` (uuid, required): The ID of the user to call

**Response:** `201 Created`
```json
{
  "id": "uuid",
  "caller_id": "uuid",
  "receiver_id": "uuid",
  "status": "initiating",
  "started_at": "datetime | null",
  "ended_at": "datetime | null",
  "duration_seconds": "integer | null",
  "created_at": "datetime",
  "updated_at": "datetime"
}
```

**Status Values:**
- `initiating`: Call is being initiated
- `ringing`: Receiver is being notified
- `active`: Call is ongoing
- `ended`: Call has ended normally
- `missed`: Call was not answered
- `rejected`: Call was rejected by receiver

**Error Responses:**
- `400 Bad Request`: Invalid receiver ID, user cannot call themselves, or active call already exists
- `401 Unauthorized`: Missing or invalid authentication token
- `404 Not Found`: Receiver user not found

---

### POST /api/video-calls/{call_id}/accept
Accepts an incoming video call.

**Path Parameters:**
- `call_id` (uuid, required): The ID of the call to accept

**Query Parameters:** None

**Request Body:** None

**Response:** `200 OK`
```json
{
  "id": "uuid",
  "caller_id": "uuid",
  "receiver_id": "uuid",
  "status": "active",
  "started_at": "datetime",
  "ended_at": "datetime | null",
  "duration_seconds": "integer | null",
  "created_at": "datetime",
  "updated_at": "datetime"
}
```

**Error Responses:**
- `400 Bad Request`: Call is not in a valid state to be accepted
- `401 Unauthorized`: Missing or invalid authentication token
- `403 Forbidden`: Only the receiver can accept the call
- `404 Not Found`: Call not found

---

### POST /api/video-calls/{call_id}/reject
Rejects an incoming video call.

**Path Parameters:**
- `call_id` (uuid, required): The ID of the call to reject

**Query Parameters:** None

**Request Body:** None

**Response:** `200 OK`
```json
{
  "id": "uuid",
  "caller_id": "uuid",
  "receiver_id": "uuid",
  "status": "rejected",
  "started_at": "datetime | null",
  "ended_at": "datetime",
  "duration_seconds": "integer | null",
  "created_at": "datetime",
  "updated_at": "datetime"
}
```

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token
- `403 Forbidden`: Only the receiver can reject the call
- `404 Not Found`: Call not found

---

### POST /api/video-calls/{call_id}/end
Ends an active video call.

**Path Parameters:**
- `call_id` (uuid, required): The ID of the call to end

**Query Parameters:** None

**Request Body:** None

**Response:** `200 OK`
```json
{
  "id": "uuid",
  "caller_id": "uuid",
  "receiver_id": "uuid",
  "status": "ended",
  "started_at": "datetime",
  "ended_at": "datetime",
  "duration_seconds": 120,
  "created_at": "datetime",
  "updated_at": "datetime"
}
```

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token
- `403 Forbidden`: User is not part of this call
- `404 Not Found`: Call not found

---

### GET /api/video-calls/{call_id}
Retrieves details of a specific video call.

**Path Parameters:**
- `call_id` (uuid, required): The ID of the call

**Query Parameters:** None

**Response:** `200 OK`
```json
{
  "id": "uuid",
  "caller_id": "uuid",
  "receiver_id": "uuid",
  "status": "active",
  "started_at": "datetime",
  "ended_at": "datetime | null",
  "duration_seconds": "integer | null",
  "created_at": "datetime",
  "updated_at": "datetime"
}
```

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token
- `403 Forbidden`: User is not part of this call
- `404 Not Found`: Call not found

---

### GET /api/video-calls
Retrieves the call history for the authenticated user.

**Path Parameters:** None

**Query Parameters:**
- `limit` (integer, optional): Number of calls to return (default: 20, max: 100)
- `offset` (integer, optional): Number of calls to skip for pagination (default: 0)

**Response:** `200 OK`
```json
{
  "data": [
    {
      "id": "uuid",
      "caller_id": "uuid",
      "receiver_id": "uuid",
      "status": "ended",
      "started_at": "datetime",
      "ended_at": "datetime",
      "duration_seconds": 120,
      "created_at": "datetime",
      "updated_at": "datetime"
    }
  ],
  "total": 50,
  "limit": 20,
  "offset": 0,
  "total_pages": 3
}
```

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token

---

### GET /api/video-calls/active
Retrieves all active calls for the authenticated user (calls with status: initiating, ringing, or active).

**Path Parameters:** None

**Query Parameters:** None

**Response:** `200 OK`
```json
[
  {
    "id": "uuid",
    "caller_id": "uuid",
    "receiver_id": "uuid",
    "status": "active",
    "started_at": "datetime",
    "ended_at": "datetime | null",
    "duration_seconds": "integer | null",
    "created_at": "datetime",
    "updated_at": "datetime"
  }
]
```

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token

---

## Notification Endpoints (Base: /api/notifications)
**All endpoints require authentication.**

### GET /api/notifications
Lists all notifications for the current user.

**Path Parameters:** None

**Query Parameters:** None

**Response:** `200 OK`
```json
[
  {
    "id": "uuid",
    "user_id": "uuid",
    "task_id": "uuid | null",
    "message": "string",
    "is_read": boolean,
    "created_at": "datetime"
  }
]
```

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token

---

### PATCH /api/notifications/:id/read
Marks a notification as read.

**Path Parameters:**
- `id` (uuid, required): Notification ID

**Query Parameters:** None

**Request Body:** None

**Response:** `200 OK` (empty body)

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token
- `404 Not Found`: Notification not found

---

### DELETE /api/notifications/:id
Deletes a specific notification.

**Path Parameters:**
- `id` (uuid, required): Notification ID

**Query Parameters:** None

**Request Body:** None

**Response:** `204 No Content` (empty body)

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token
- `404 Not Found`: Notification not found

---

### PUT /api/notifications/preferences
Updates global notification settings for the user.

**Path Parameters:** None

**Query Parameters:** None

**Request Body (JSON):**
```json
{
  "notification_enabled": boolean (required)
}
```

**Fields:**
- `notification_enabled` (boolean, required): Enable/disable notifications

**Response:** `200 OK`
```json
{
  "notification_enabled": boolean
}
```

**Error Responses:**
- `400 Bad Request`: Validation error
- `401 Unauthorized`: Missing or invalid authentication token

---

### GET /api/notifications/stream
Server-Sent Events (SSE) stream for real-time notification delivery.

**Path Parameters:** None

**Query Parameters:** None

**Headers:**
- `Accept: text/event-stream` (recommended)

**Response:** `200 OK` (SSE stream)
- Content-Type: `text/event-stream`
- Streams notification events as they occur

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token

**Note:** Connection remains open until client disconnects. Server sends periodic keep-alive pings.

---

## Admin Management Endpoints (Base: /api/admin)

### POST /api/admin/register
**Public endpoint - No authentication required.** Register a new admin user. Creates user with `is_admin: true`, `role: "admin"`, and `is_active: true`. 

**Important:** Once registered, you immediately have full access to all admin features. No verification or approval is required. You can use the returned access token to access all other admin endpoints right away.

**Path Parameters:** None

**Query Parameters:** None

**Request Body (JSON):**
```json
{
  "username": "string (required, min: 3, max: 255 characters)",
  "email": "string (required, valid email format)",
  "password": "string (required, min: 6 characters)"
}
```

**Fields:**
- `username` (string, required): Username for the admin account (3-255 characters)
- `email` (string, required): Valid email address
- `password` (string, required): Password (minimum 6 characters)

**Response:** `201 Created`
```json
{
  "access_token": "string",
  "refresh_token": "string",
  "user": {
    "id": "uuid",
    "username": "string",
    "email": "string",
    "role": "admin",
    "is_admin": true,
    "is_active": true,
    "avatar_url": "string | null",
    "bio": "string | null",
    "theme": "string",
    "notification_enabled": true,
    "created_at": "datetime"
  }
}
```

**Error Responses:**
- `400 Bad Request`: Validation error (e.g., invalid email format, password too short, username too short)
- `409 Conflict`: User already exists (duplicate email or username)
- `500 Internal Server Error`: Server error

**Note:** This endpoint is publicly accessible. No authentication token is required. After successful registration, you receive an access token that immediately grants you full admin privileges.

---

**All endpoints below require admin authentication (both auth middleware and admin middleware).**

### GET /api/admin/users
Lists all registered users (paginated). Admin only.

**Path Parameters:** None

**Query Parameters:**
- `page` (integer, optional): Page number (default: 1, minimum: 1)
- `limit` (integer, optional): Items per page (default: 10, maximum: 100)

**Response:** `200 OK`
```json
{
  "data": [
    {
      "id": "uuid",
      "username": "string",
      "email": "string",
      "role": "string",
      "is_admin": boolean,
      "is_active": boolean,
      ...
    }
  ],
  "total": integer,
  "page": integer,
  "limit": integer,
  "total_pages": integer
}
```

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token
- `403 Forbidden`: Not an admin user

---

### GET /api/admin/users/:user_id
Retrieves detailed profile for any user. Admin only.

**Path Parameters:**
- `user_id` (uuid, required): User ID

**Query Parameters:** None

**Response:** `200 OK`
```json
{
  "id": "uuid",
  "username": "string",
  "email": "string",
  "role": "string",
  "is_admin": boolean,
  "is_active": boolean,
  "avatar_url": "string | null",
  "bio": "string | null",
  "theme": "string",
  "notification_enabled": boolean,
  "created_at": "datetime",
  "updated_at": "datetime"
}
```

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token
- `403 Forbidden`: Not an admin user
- `404 Not Found`: User not found

---

### PUT /api/admin/users/:user_id
Manually updates user account details. Admin only.

**Path Parameters:**
- `user_id` (uuid, required): User ID

**Query Parameters:** None

**Request Body (JSON):**
```json
{
  "username": "string (optional, min: 3, max: 255 characters)",
  "email": "string (optional, valid email format)",
  "bio": "string (optional)",
  "theme": "string (optional)",
  "avatar_url": "string (optional)",
  "is_admin": boolean (optional),
  "is_active": boolean (optional)
}
```

**Fields:**
- `username` (string, optional): Username (3-255 characters)
- `email` (string, optional): Email address (valid email format)
- `bio` (string, optional): Biography
- `theme` (string, optional): Theme preference
- `avatar_url` (string, optional): Avatar URL
- `is_admin` (boolean, optional): Admin status (if changed, role will also update)
- `is_active` (boolean, optional): Account active status

**Response:** `200 OK`
```json
{
  "id": "uuid",
  "username": "string",
  "email": "string",
  "role": "string",
  "is_admin": boolean,
  ...
}
```

**Note:** If `is_admin` is updated, the `role` field will automatically be set to `"admin"` if `is_admin` is true, or `"user"` if false.

**Error Responses:**
- `400 Bad Request`: Validation error
- `401 Unauthorized`: Missing or invalid authentication token
- `403 Forbidden`: Not an admin user
- `404 Not Found`: User not found

---

### DELETE /api/admin/users/:user_id
Deletes a user account. Admin only.

**Path Parameters:**
- `user_id` (uuid, required): User ID

**Query Parameters:** None

**Request Body:** None

**Response:** `204 No Content` (empty body)

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token
- `403 Forbidden`: Not an admin user
- `404 Not Found`: User not found

---

### PATCH /api/admin/users/:user_id/status
Activates or deactivates a user account. Admin only.

**Path Parameters:**
- `user_id` (uuid, required): User ID

**Query Parameters:** None

**Request Body (JSON):**
```json
{
  "is_active": boolean (required)
}
```

**Fields:**
- `is_active` (boolean, required): Account active status

**Response:** `200 OK`
```json
{
  "id": "uuid",
  "username": "string",
  "is_active": boolean,
  ...
}
```

**Error Responses:**
- `400 Bad Request`: Validation error
- `401 Unauthorized`: Missing or invalid authentication token
- `403 Forbidden`: Not an admin user
- `404 Not Found`: User not found

---

### PATCH /api/admin/users/:user_id/admin
Promotes or demotes a user to/from Admin role. Admin only.

**Path Parameters:**
- `user_id` (uuid, required): User ID

**Query Parameters:** None

**Request Body (JSON):**
```json
{
  "is_admin": boolean (required)
}
```

**Fields:**
- `is_admin` (boolean, required): Admin status

**Response:** `200 OK`
```json
{
  "id": "uuid",
  "username": "string",
  "role": "string",
  "is_admin": boolean,
  ...
}
```

**Note:** Setting `is_admin` to `true` will set `role` to `"admin"`. Setting it to `false` will set `role` to `"user"`.

**Error Responses:**
- `400 Bad Request`: Validation error
- `401 Unauthorized`: Missing or invalid authentication token
- `403 Forbidden`: Not an admin user
- `404 Not Found`: User not found

---

### GET /api/admin/tasks
Searches and lists all tasks in the entire system. Admin only.

**Path Parameters:** None

**Query Parameters:**
- `status` (string, optional): Filter by single status
- `statuses[]` (array of strings, optional): Filter by multiple statuses
- `priority` (string, optional): Filter by single priority
- `priorities[]` (array of strings, optional): Filter by multiple priorities
- `search` (string, optional): Search in title and description
- `created_from` (datetime, optional): Filter tasks created after this date
- `created_to` (datetime, optional): Filter tasks created before this date
- `due_from` (datetime, optional): Filter tasks due after this date
- `due_to` (datetime, optional): Filter tasks due before this date
- `user_id` (uuid, optional): Filter by task owner
- `page` (integer, optional): Page number (default: 1)
- `limit` (integer, optional): Items per page (default: 10)

**Response:** `200 OK`
```json
{
  "data": [
    {
      "id": "uuid",
      "user_id": "uuid",
      "title": "string",
      ...
    }
  ],
  "total": integer,
  "page": integer,
  "limit": integer,
  "total_pages": integer
}
```

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token
- `403 Forbidden`: Not an admin user

---

### GET /api/admin/users/:user_id/tasks
Lists all tasks belonging to a specific user. Admin only.

**Path Parameters:**
- `user_id` (uuid, required): User ID

**Query Parameters:**
- `status` (string, optional): Filter by single status
- `statuses[]` (array of strings, optional): Filter by multiple statuses
- `priority` (string, optional): Filter by single priority
- `priorities[]` (array of strings, optional): Filter by multiple priorities
- `search` (string, optional): Search in title and description
- `created_from` (datetime, optional): Filter tasks created after this date
- `created_to` (datetime, optional): Filter tasks created before this date
- `due_from` (datetime, optional): Filter tasks due after this date
- `due_to` (datetime, optional): Filter tasks due before this date
- `page` (integer, optional): Page number (default: 1)
- `limit` (integer, optional): Items per page (default: 10)

**Response:** `200 OK`
```json
{
  "data": [
    {
      "id": "uuid",
      "user_id": "uuid",
      "title": "string",
      ...
    }
  ],
  "total": integer,
  "page": integer,
  "limit": integer,
  "total_pages": integer
}
```

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token
- `403 Forbidden`: Not an admin user
- `404 Not Found`: User not found

---

### DELETE /api/admin/tasks/:task_id
Force deletes any task in the system. Admin only.

**Path Parameters:**
- `task_id` (uuid, required): Task ID

**Query Parameters:** None

**Request Body:** None

**Response:** `204 No Content` (empty body)

**Error Responses:**
- `401 Unauthorized`: Missing or invalid authentication token
- `403 Forbidden`: Not an admin user
- `404 Not Found`: Task not found

---

## WebSocket Real-time Communication
**Endpoint:** `/ws` (WebSocket connection, not under `/api`)

### Authentication
Requires authentication via Bearer token:
- **Query Parameter:** `?token=<jwt_token>`
- Or in the WebSocket sub-protocol header

### Connection
**URL:** `ws://your-domain.com/ws?token=<jwt_token>`

### Message Types

#### 1. Chat Messages (`chat_message`)
Real-time message delivery.

**Client → Server:** N/A (messages sent via REST API)

**Server → Client:**
```json
{
  "type": "chat_message",
  "payload": {
    "id": "uuid",
    "sender_id": "uuid",
    "receiver_id": "uuid",
    "content": "string",
    "image_url": "string | null",
    "created_at": "datetime (RFC3339 format)"
  }
}
```

#### 2. Typing Indicators (`typing_indicator`)
Shows when a user is typing.

**Client → Server:**
```json
{
  "type": "typing_indicator",
  "payload": {
    "user_id": "uuid",
    "is_typing": boolean
  }
}
```

**Server → Client:**
```json
{
  "type": "typing_indicator",
  "payload": {
    "user_id": "uuid",
    "is_typing": boolean
  }
}
```

#### 3. User Status Updates (`user_status`)
Online/offline status changes.

**Server → Client:**
```json
{
  "type": "user_status",
  "payload": {
    "user_id": "uuid",
    "status": "online" | "offline"
  }
}
```

#### 4. Heartbeats (`ping`/`pong`)
Connection keep-alive mechanism.

**Server → Client:**
```json
{
  "type": "ping"
}
```

**Client → Server:**
```json
{
  "type": "pong"
}
```

#### 5. Error Messages (`error`)
Error notifications.

**Server → Client:**
```json
{
  "type": "error",
  "payload": {
    "message": "string",
    "code": "string"
  }
}
```

#### 6. Video Call Signaling

##### Call Initiated (`call_initiated`)
Sent to the receiver when a call is initiated.

**Server → Client:**
```json
{
  "type": "call_initiated",
  "payload": {
    "call_id": "uuid",
    "caller_id": "uuid",
    "receiver_id": "uuid"
  }
}
```

##### Call Accepted (`call_accepted`)
Sent to the caller when the receiver accepts the call.

**Server → Client:**
```json
{
  "type": "call_accepted",
  "payload": {
    "call_id": "uuid",
    "caller_id": "uuid",
    "receiver_id": "uuid"
  }
}
```

##### Call Rejected (`call_rejected`)
Sent to the caller when the receiver rejects the call.

**Server → Client:**
```json
{
  "type": "call_rejected",
  "payload": {
    "call_id": "uuid",
    "caller_id": "uuid",
    "receiver_id": "uuid"
  }
}
```

##### Call Ended (`call_ended`)
Sent to both participants when a call ends.

**Server → Client:**
```json
{
  "type": "call_ended",
  "payload": {
    "call_id": "uuid",
    "ended_by": "uuid"
  }
}
```

##### WebRTC Offer (`call_offer`)
WebRTC SDP offer for establishing peer connection.

**Client → Server:**
```json
{
  "type": "send_call_offer",
  "payload": {
    "call_id": "uuid",
    "to_user_id": "uuid",
    "sdp": "string"
  }
}
```

**Server → Client:**
```json
{
  "type": "call_offer",
  "payload": {
    "call_id": "uuid",
    "from_user_id": "uuid",
    "to_user_id": "uuid",
    "sdp": "string"
  }
}
```

##### WebRTC Answer (`call_answer`)
WebRTC SDP answer for establishing peer connection.

**Client → Server:**
```json
{
  "type": "send_call_answer",
  "payload": {
    "call_id": "uuid",
    "to_user_id": "uuid",
    "sdp": "string"
  }
}
```

**Server → Client:**
```json
{
  "type": "call_answer",
  "payload": {
    "call_id": "uuid",
    "from_user_id": "uuid",
    "to_user_id": "uuid",
    "sdp": "string"
  }
}
```

##### ICE Candidate (`ice_candidate`)
ICE candidate exchange for NAT traversal.

**Client → Server:**
```json
{
  "type": "send_ice_candidate",
  "payload": {
    "call_id": "uuid",
    "to_user_id": "uuid",
    "candidate": "string"
  }
}
```

**Server → Client:**
```json
{
  "type": "ice_candidate",
  "payload": {
    "call_id": "uuid",
    "from_user_id": "uuid",
    "to_user_id": "uuid",
    "candidate": "string"
  }
}
```

##### Accept/Reject/End Call Actions

**Client → Server:**
```json
{
  "type": "accept_call",
  "payload": {
    "call_id": "uuid"
  }
}
```

```json
{
  "type": "reject_call",
  "payload": {
    "call_id": "uuid"
  }
}
```

```json
{
  "type": "end_call",
  "payload": {
    "call_id": "uuid"
  }
}
```

### Error Responses
- Connection refused if token is missing or invalid
- Connection closed if authentication fails

---

## Common Data Types

### UUID Format
All UUIDs are in standard UUID v4 format:
```
550e8400-e29b-41d4-a716-446655440000
```

### DateTime Format
All datetime values use ISO 8601 format with UTC timezone:
```
2024-01-15T10:30:00Z
```

### Task Status Values
- `pending`: Task is not yet started
- `in_progress`: Task is currently being worked on
- `completed`: Task is finished
- `cancelled`: Task was cancelled

### Task Priority Values
- `low`: Low priority task
- `medium`: Medium priority task (default)
- `high`: High priority task
- `urgent`: Urgent priority task

### User Role Values
- `user`: Regular user
- `admin`: Administrator user

---

## Response Formats

### Paginated Response
```json
{
  "data": [...],
  "total": integer,
  "page": integer,
  "limit": integer,
  "total_pages": integer
}
```

### Error Response
```json
{
  "error": "Error message description"
}
```

### Authentication Response
```json
{
  "access_token": "string",
  "refresh_token": "string",
  "user": {
    "id": "uuid",
    "username": "string",
    "email": "string",
    "role": "string",
    "is_admin": boolean,
    ...
  }
}
```

---

## Status Codes
- `200 OK`: Successful request
- `201 Created`: Resource created successfully
- `204 No Content`: Successful deletion (empty response body)
- `302 Found`: Redirect (used for OAuth flows)
- `400 Bad Request`: Validation error or invalid input
- `401 Unauthorized`: Missing or invalid authentication token
- `403 Forbidden`: Insufficient permissions (e.g., not an admin, not task owner)
- `404 Not Found`: Resource not found
- `409 Conflict`: Resource conflict (e.g., user already exists)
- `500 Internal Server Error`: Server error

---

## CORS Configuration
The API supports CORS for the following origins:
- `http://localhost:3000`
- `http://127.0.0.1:3000`
- `http://localhost:8080`
- Production frontend domains (configured in environment)

**Allowed HTTP Methods:**
- GET, POST, PUT, PATCH, DELETE, OPTIONS

**Allowed Headers:**
- `Authorization`
- `Content-Type`

**Credentials:** Supported (cookies, authorization headers)

---

## Rate Limiting
Currently, no rate limiting is implemented. Consider implementing rate limiting for production use.

---

## Interactive API Documentation
Visit `/swagger-ui` on the deployed server for interactive API documentation powered by Swagger UI.

The OpenAPI specification is available at `/api-docs/openapi.json`.

---

## Notes

### Login Authentication
- **Important:** Login is **email-only**. Users cannot login with username. The system validates that the email field is a valid email format.
- Users registered via Google OAuth cannot login with email/password unless they set a password.

### Admin Registration
- **Public Access:** `/api/admin/register` is publicly accessible - no authentication required.
- **Immediate Access:** Once you register as an admin, you immediately have full access to all admin features. No verification or approval is needed.
- The registered user is created with `is_admin: true`, `role: "admin"`, and `is_active: true`.
- You receive an access token upon registration that can be used immediately to access all admin endpoints.
- Regular registration (`/api/auth/register`) always creates regular users (`is_admin: false`).

### Task Sharing
- Tasks can be shared with multiple users.
- Shared tasks appear in the recipient's task list.
- Only the task owner can share, update, or delete tasks.
- Task members can view and potentially update task status (depending on implementation).

### Real-time Features
- Server-Sent Events (SSE) are used for task and notification streams.
- WebSocket is used for real-time messaging, typing indicators, and video call signaling.
- Both require authentication via Bearer token.

### Video Calls
- Video calls use WebRTC for peer-to-peer communication.
- The server handles signaling (SDP offers/answers and ICE candidates) through WebSocket.
- Call statuses are tracked: `initiating`, `ringing`, `active`, `ended`, `missed`, `rejected`.
- Only one active call can exist between two users at a time.
- Call duration is automatically calculated when a call ends.
- WebRTC signaling messages (offers, answers, ICE candidates) are forwarded directly between participants via WebSocket.
- The receiver must accept the call via API endpoint or WebSocket message before the call becomes active.
- Either participant can end the call at any time.

### Group Chat
- Groups are private and only accessible to members.
- Only the group creator can:
  - Update group information (name, description, avatar)
  - Delete the group
  - Add members to the group
  - Remove members from the group
- Group messages are sent to all group members via WebSocket.
- All group members receive notifications when a new message is sent.
- The group creator cannot be removed from the group.
- When sending a message, use `group_id` for group messages and `receiver_id` for 1-on-1 messages.
